<!DOCTYPE HTML>
<html>

<head>
    <title>Tumasulo Simulator</title>
    <meta charset="utf-8">
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
    <style type="text/css">
        hr {
            margin: 5px 0;
        }
    </style>
</head>

<body>


    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span12">

                <h4>
                    <input type="file" id="inst_input" onchange="loadInstsFromFile(event)"/>
                    <button class="btn" id="next_cycle" onclick="next_cycle()">Next Cycle</button>
                    <img alt="" style="width:40px;height:auto;" src="https://image.freepik.com/free-icon/timer_318-61019.jpg" />
                    <span id="cycle-num">0</span>
                </h4>
            </div>
        </div>
        <hr>
        <div class="row-fluid">
            <div class="span4">
                <h4>
                    Load Queue
                </h4>
                <table class="table table-striped table-hover table-condensed table-bordered" id="load-queue">
                    <thead>
                        <tr>
                            <th>
                            </th>
                            <th>
                                Busy
                            </th>
                            <th>
                                Address
                            </th>
                            <th>
                                Cache
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                Load1
                            </td>
                            <td>
                                N0
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Load2
                            </td>
                            <td>
                                N0
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Load3
                            </td>
                            <td>
                                N0
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <hr>
                <h4>
                    Store Queue
                </h4>
                <table class="table table-striped table-hover table-condensed table-bordered" id="store-queue">
                    <thead>
                        <tr>
                            <th>
                            </th>
                            <th>
                                Busy
                            </th>
                            <th>
                                Address
                            </th>
                            <th>
                                Q<sub>i</sub>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                Store1
                            </td>
                            <td>
                                N0
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Store2
                            </td>
                            <td>
                                N0
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                Store3
                            </td>
                            <td>
                                N0
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="span8">
                <h4>
                    Reservation Stations
                </h4>
                <table class="table table-striped table-hover table-bordered table-condensed" id="reserve-stations">
                    <thead>
                        <tr>
                            <th>
                                Time
                            </th>
                            <th>
                                Name
                            </th>
                            <th>
                                Busy
                            </th>
                            <th>
                                Op
                            </th>
                            <th>
                                V<sub>j</sub>
                            </th>
                            <th>
                                V<sub>k</sub>
                            </th>
                            <th>
                                Q<sub>j</sub>
                            </th>
                            <th>
                                Q<sub>k</sub>
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                            </td>
                            <td>
                                Add1
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                            </td>
                            <td>
                                Add2
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                            </td>
                            <td>
                                Add3
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                            </td>
                            <td>
                                Mult1
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                        <tr>
                            <td>
                            </td>
                            <td>
                                Mult2
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <hr>
                <h4 class="text-left">
                    浮点寄存器FU
                </h4>
                <table class="table table-striped table-hover table-bordered table-condensed" id="float-regs">
                    <thead>
                        <tr>
                            <th>
                                编号
                            </th>
                            <th>
                                F0
                            </th>
                            <th>
                                F1
                            </th>
                            <th>
                                F2
                            </th>
                            <th>
                                F3
                            </th>
                            <th>
                                F4
                            </th>
                            <th>
                                F5
                            </th>
                            <th>
                                F6
                            </th>
                            <th>
                                F7
                            </th>
                            <th>
                                F8
                            </th>
                            <th>
                                F9
                            </th>
                            <th>
                                F10
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <strong>数据</strong>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                            <td>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <hr>
        <div class="row-fluid">
            <div class="span6">
                <h4 class="text-left">


                    <div class="form-search">
                        <span>指令队列</span>
                        <button class="btn">Last 5</button>
                        <input type="text" class="input-medium search-query">
                        <button type="submit" class="btn">Goto</button>
                        <button class="btn">Next 5</button>
                    </div>

                </h4>
                <table class="table table-striped table-hover table-bordered table-condensed" id="inst-table">
                    <thead>
                        <tr>
                            <th>Index</th>
                            <th>
                                Name
                            </th>
                            <th>
                                Dest.
                            </th>
                            <th>
                                Source<sub>j</sub>
                            </th>
                            <th>
                                Source<sub>k</sub>
                            </th>
                            <th>
                                发射
                            </th>
                            <th>
                                执行完毕
                            </th>
                            <th>
                                写回
                            </th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td>5</td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="span6">
                <h4>
                    <div class="form-inline">
                        <span>内存MEM</span>
                        <input type="text" class="input-medium search-query" id="mem-addr">
                        <button type="button" class="btn" onclick="view_mem()">Goto</button>
                    </div>
                </h4>
                <table class="table table-striped table-hover table-condensed table-bordered" id="mem-table">
                    <thead>
                        <tr>
                            <th>
                                地址
                            </th>
                            <th>
                            </th>
                            <th>
                            </th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>
                                <strong>数据</strong>
                            </td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</body>

<script src="js/patched_class.js"></script>
<script src="js/init.js"></script>

<script>
    function loadInstsFromFile(event) {

        var file = event.target.files[0];
        var reader = new FileReader();
        reader.onload = function(event) {
            // The file's text will be printed here
            var lines = event.target.result.split('\n');
            console.log(lines);
            // simulator.nInsts = lines.length;
            for (var i = 0; i < lines.length; ++i) {
                var parts = lines[i].split(' ');
                console.log(parts);
                if (parts.length == 1) {
                    console.log('End');
                    continue;
                }
                var inst = new Instruction(parts[0], parts[1], parts[2], parts[3]);
                inst.index = i;
                simulator.instQueue.push(inst);
                console.log(simulator.instQueue[i].toString());

                // update table
                var table = document.getElementById("inst-table");
                var end = Math.min(lines.length, 5);
                r = i + 1;
                table.rows[r].cells[1].innerHTML = parts[0];
                table.rows[r].cells[2].innerHTML = parts[1];
                table.rows[r].cells[3].innerHTML = parts[2];
                table.rows[r].cells[4].innerHTML = parts[3];
            }
            // simulator.nInsts = 0;
        };
        reader.readAsText(file);
    }

    function next_cycle() {
        simulator.oneCycle();
    }
</script>

</html>