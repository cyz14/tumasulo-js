<!DOCTYPE HTML>
<html>

<head>
    <title>Tumasulo Simulator</title>
    <meta charset="utf-8">
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
</head>

<body>

<div class="container-fluid">
    <div class="row-fluid">
        <div class="span12">
            <form class="form-inline">
                <label>Select File</label>
                <input class="btn" type="file" id="inst_input" onchange="loadInstsFromFile(event)"/>
                <button type="submit" class="btn">Submit</button>
            </form>
            <button class="btn" id="next_cycle" onclick="next_cycle()">Next Cycle</button>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span12">
            <h3>
                Reservation Stations
            </h3>
            <table class="table table-bordered table-condensed">
                <thead>
                    <tr>
                        <th>
                            Time
                        </th>
                        <th>
                            Name
                        </th>
                        <th>
                            Busy
                        </th>
                        <th>
                            Op
                        </th>
                        <th>
                            V<sub>j</sub>
                        </th>
                        <th>
                            V<sub>k</sub>
                        </th>
                        <th>
                            Q<sub>j</sub>
                        </th>
                        <th>
                            Q<sub>k</sub>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                        </td>
                        <td>
                            Add1
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="success">
                        <td>
                        </td>
                        <td>
                            Add2
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="error">
                        <td>
                        </td>
                        <td>
                            Add3
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="warning">
                        <td>
                        </td>
                        <td>
                            Mult1
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="info">
                        <td>
                        </td>
                        <td>
                            Mult2
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3 class="text-left">
                浮点寄存器FU
            </h3>
            <table class="table table-bordered table-condensed" id="float-regs">
                <thead>
                    <tr>
                        <th>
                            编号
                        </th>
                        <th>
                            F0
                        </th>
                        <th>
                            F1
                        </th>
                        <th>
                            F2
                        </th>
                        <th>
                            F3
                        </th>
                        <th>
                            F4
                        </th>
                        <th>
                            F5
                        </th>
                        <th>
                            F6
                        </th>
                        <th>
                            F7
                        </th>
                        <th>
                            F8
                        </th>
                        <th>
                            F9
                        </th>
                        <th>
                            F10
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <strong>表达式</strong>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="success">
                        <td>
                            <strong>数据</strong>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row-fluid">
        <div class="span8">
            <h3 class="text-left">
                
                
                <form class="form-search">
                    <span>指令队列</span>
                    <button class="btn">Last 5</button>
                    <input type="text" class="input-medium search-query">
                    <button type="submit" class="btn">Goto</button>
                    <button class="btn">Next 5</button>
                </form>
                
            </h3>
            <table class="table table-hover table-bordered table-condensed">
                <thead>
                    <tr>
                        <th>
                            Name
                        </th>
                        <th>
                            Dest.
                        </th>
                        <th>
                            Source<sub>j</sub>
                        </th>
                        <th>
                            Source<sub>k</sub>
                        </th>
                        <th>
                            发射
                        </th>
                        <th>
                            执行完毕
                        </th>
                        <th>
                            写回
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            1
                        </td>
                        <td>
                            TB - Monthly
                        </td>
                        <td>
                            01/04/2012
                        </td>
                        <td>
                            Default
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="success">
                        <td>
                            1
                        </td>
                        <td>
                            TB - Monthly
                        </td>
                        <td>
                            01/04/2012
                        </td>
                        <td>
                            Approved
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="error">
                        <td>
                            2
                        </td>
                        <td>
                            TB - Monthly
                        </td>
                        <td>
                            02/04/2012
                        </td>
                        <td>
                            Declined
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="warning">
                        <td>
                            3
                        </td>
                        <td>
                            TB - Monthly
                        </td>
                        <td>
                            03/04/2012
                        </td>
                        <td>
                            Pending
                        </td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    <tr class="info">
                        <td>
                            4
                        </td>
                        <td>
                            TB - Monthly
                        </td>
                        <td>
                            04/04/2012
                        </td>
                        <td>
                            Call in to confirm
                        </td>

                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                </tbody>
            </table>
            <ul>
                <li>
                    指令条数:
                </li>
                <li>
                    PC:
                </li>
            </ul>
            <h3>
                <img alt="" style="width:100px;height:auto;"src="https://image.freepik.com/free-icon/timer_318-61019.jpg" />0
            </h3>
            <h3>
                <form class="form-inline">
                    <span>内存MEM</span>
                    <input type="text" class="input-medium search-query">
                    <button type="submit" class="btn">Goto</button>
                </form>
            </h3>
            <table class="table table-condensed table-bordered">
                <thead>
                    <tr>
                        <th>
                            地址
                        </th>
                        <th>
                        </th>
                        <th>
                        </th>
                        <th>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            <strong>数据</strong>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <div class="span4">
            <h3>
                Load Queue
            </h3>
            <table class="table table-bordered">
                <thead>
                    <tr>
                        <th>
                        </th>
                        <th>
                            Busy
                        </th>
                        <th>
                            Address
                        </th>
                        <th>
                            Cache
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            Load1
                        </td>
                        <td>
                            N0
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="success">
                        <td>
                            Load2
                        </td>
                        <td>
                            N0
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="error">
                        <td>
                            Load3
                        </td>
                        <td>
                            N0
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                </tbody>
            </table>
            <h3>
                Store Queue
            </h3>
            <table class="table table-condensed table-bordered">
                <thead>
                    <tr>
                        <th>
                        </th>
                        <th>
                            Busy
                        </th>
                        <th>
                            Address
                        </th>
                        <th>
                            Q<sub>i</sub>
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            Store1
                        </td>
                        <td>
                            N0
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="success">
                        <td>
                            Store2
                        </td>
                        <td>
                            N0
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                    <tr class="error">
                        <td>
                            Store3
                        </td>
                        <td>
                            N0
                        </td>
                        <td>
                        </td>
                        <td>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
</div>

</body>

<script src="js/patched_class.js"></script>
<script src="js/init.js"></script>

<script>
    function loadInstsFromFile(event) {
        var file = event.target.files[0];
        var reader = new FileReader();
        reader.onload = function(event) {
            // The file's text will be printed here
            var lines = event.target.result.split('\n');
            console.log(lines);
            // simulator.nInsts = lines.length;
            for (var i = 0; i < lines.length; ++i) {
                var parts = lines[i].split(' ');
                console.log(parts);
                if (parts.length == 1) {
                    console.log('End');
                    continue;
                }
                var inst = new Instruction(parts[0], parts[1], parts[2], parts[3]);
                simulator.instQueue.push(inst);
                console.log(simulator.instQueue[i].toString());
            }
            // simulator.nInsts = 0;
        };
        reader.readAsText(file);
    }

    function next_cycle() { 
        simulator.oneCycle();

        var table = document.getElementById('float-regs');
        for (var r = 2, n = table.rows.length; r < n; r++) {
            for (var c = 1, m = table.rows[r].cells.length; c < m; c++) {
                table.rows[r].cells[c].innerHTML=simulator.Regs[i];
            }
        }
    }
</script>

</html>